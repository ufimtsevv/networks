
# 7: Сравнение IPv4 и IPv6 в Docker
Простое приложение на FastAPI с PostgreSQL и Nginx в Docker-контейнерах + блокировка российских IP на уровне Nginx с HTML-заглушкой.

---
### 1. Настройка окружения
Активация IPv6 в Docker:
```
{
  "ipv6": true,
  "fixed-cidr-v6": "2001:db8:1::/64",
  "experimental": true
}
```
### 2. Создание тестовой сети  
  ```
  docker network create --ipv6 --subnet="2001:db8:1::/64" ipv6_net
  ```
### 3. Запуск контейнеров
  ```
  docker run -itd --network=ipv6_net --name=container1 alpine ash
  docker run -itd --network=ipv6_net --name=container2 alpine ash
  ```
### 4. Проверка подключения и тесты
  ```
docker exec container1 ping -c 4 $(docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' container2)
docker exec container1 ping6 -c 4 $(docker inspect -f '{{range .NetworkSettings.Networks}}{{.GlobalIPv6Address}}{{end}}' container2)
  ```
### 5. Анализ трафика
Просмотр результатов с помощью `Wireshark`

---

### Сравнительный анализ
|                     | IPv4               | IPv6 |
| -------------------------- | --------------------- | ----- |
| Длина адреса       | 32 бита (4.3 млрд адресов) | 128 бит (3.4×10³⁸ адресов) |
| Формат адреса      | Десятичный с точками | Шестнадцатеричный с двоеточиями  |
| Размер заголовка   | 	20-60 байт (переменный) | 40 байт (фиксированный) |
| Фрагментация   | 	На маршрутизаторах | Только у отправителя |
| NAT   | 	Обязателен | Не требуется |
| Безопасность  | 	IPSec опционален | IPSec встроен |
| Multicast   | 		Ограниченная поддержка | Полноценная реализация |
| Конфигурация  | 	DHCP/ручная | Автоконфигурация (SLAAC) |

---
### Производительность на тестах:
|                     | IPv4               | IPv6 | Разница |
|---|--- |--- |---|
|Средняя задержка|0.079 мс|0.081 мс|+2.5%|
|Минимальная RTT|0.074 мс|0.067 мс|-9.5%|
|Максимальная RTT|0.088 мс|0.108 мс|+22.7%|

---
### Вывод

В локальной сети разница незначительна, но `IPv6` показывает лучшую минимальную задержку и больший разброс значений. 

Ключевое отличие заключается в том, что `IPv6` исключает необходимость `NAT`, что обеспечивает прямые `end-to-end` соединения, упрощенную диагностику сети и встроенную безопасность.

Делаем вывод, что `IPv6` значительно лучше чем `IPv4` за счет упрощения сети и лучшей масштабируемости, а также будущей совместимости.